# Git: First Time Setup

## Contents

- [Introduction](#introduction)
- [Installation](#installing-git)
  - [OS X](#os-x)
  - [Microsoft Windows](#microsoft-windows)
- [Using Command Line Git](#using-git)
  - [OS X](#os-x-1)
  - [Microsoft Windows](#microsoft-windows-1)
- [Configuration](#configuration)
  - [Microsoft Windows](#microsoft-windows-2)
- [SSH Key Generation](#ssh-key-generation)
  - [Checking for an Existing Key](#checking-for-an existing-key)
  - [Generating a New Key](#generating-a-new-key)
  - [Adding Your Key to Gerrit](#adding-your-key-to-gerrit)
  - [Adding Gerrit Keys to Known Hosts](#adding-gerrit-keys-to-known-hosts)

## Introduction

This guide provides instructions on how to install and configure git ready for enterprise usage via
Gerrit. Steps are provided for both Microsoft Windows and OS X users.

Git usage via a third party GUI is not supported by this guide - steps are provided for command line
use only.

## Installation

Even if Git is already installed, complete this step to ensure the latest version is installed.

Before continuing, download the latest stable version of Git for your operating system from
http://git-scm.com/.

### OS X

Run the Git installer file `.dmg`. A new Finder window will show its contents, including a package
file `.pkg` and a readme `.txt`.

Follow the instructions in the readme, in particular *Step 2 - Remove stubs* (if present).

### Microsoft Windows

Run the Git installer file `.exe` and carefully consider each option presented on each installation
screen. Ensure the following settings are configured correctly:

- **Select components**  
  Windows Explorer Integration can be unselected at the user's preference. By default this adds
  *Git Bash Here* to the right click context menu in folders.

- **Adjusting your PATH environment**  
  Select *Use Git from Git Bash only* (top option).

- **Choosing the SSH executable**  
  Select *Use OpenSSH* (top option).

- **Configuring the line ending conversions**  
  Select *Checkout Windows-style, commit Unix-style line endings* (top option).

## Using Command Line Git

Once you have an operating system specific command line tool open, run the following command to
verify that Git has been installed:

```bash
git --version
```

### OS X

As OS X is a Unix-based operating system, no special software is required. Git can be accessed by
opening **Terminal** via **Spotlight**.

### Microsoft Windows

Open **Git Bash** from the **Start menu**, either via *All Programs* or the search box.

Using the Windows installation options provided above, Git will *not* work via
**Windows Command Processor** / `cmd.exe`.

## Configuration

In order to use Git, particularly with enterprise managed repositories and Gerrit, it is necessary
to run the following commands (make sure to substitute your own details):

```bash
git config --global user.name enterprise.id
git config --global user.email enterprise.id@company.com
```

### Microsoft Windows

Windows users also need to run the following command to ensure that Git handles line endings
correctly:

```bash
git config --global core.autocrlf true
```

## SSH Key Generation

When accessing enterprise managed repositories, Git will always ask for your enterprise credentials.
This can be avoided by providing Gerrit with an SSH key. As Gerrit requires your enterprise
credentials to log in, this is still a secure way to access repositories.

Microsoft Windows users, please note that this section uses UNIX commands; these can be ran via
**Git Bash**.

### Checking for an Existing Key

Before beginning, check if you already have an SSH key generated by running the following command
via command line Git:

```bash
cat ~/.ssh/id_rsa.pub
```

If this returns a string beginning with `ssh-rsa`, you already have an SSH key and can skip the next
step.

### Generating a New Key

Run the command below (making sure to substitute your email address) to begin generating a new SSH
key, then follow the proceeding instructions for completing the user prompts:

```bash
ssh-keygen -t rsa -b 4096 -C enterprise.id@company.com
```

- **Enter file in which to save the key:**  
  Press enter to use the default directory.

- **Enter passphrase**
  If you `enter` a password, you will be prompted for this instead of your enterprise credentials.
  Alternatively press `enter` to use no password.

Once completed, the `.ssh/` directory is created in your user directory and contains the public
(`id_rsa.pub`) and private (`id_rsa`) key parts.

### Adding Your Key to Gerrit

Copy your public SSH key part from `.ssh/id_rsa.pub` to the clipboard by opening the file in a text
editor or re-running the command from [Checking for an Existing Key](#checking-for-an-existing-key).

Navigate to the Gerrit *SSH Public Keys* settings page. Settings can be found by clicking your name
in the top right corner.

Click the *Add Key ...* button, paste your public key part in the box and click *Add*.

![](Images/first-time-setup-ssh-add.png?raw=true)

### Adding Gerrit Keys to Known Hosts

Now that Gerrit has your public key, you need to do the opposite and add Gerrit's public keys to
your `known_hosts` file.

This file might not exist yet; if not, create `known_hosts` inside `.ssh/`.

Still on the Gerrit *SSH Public Keys* settings page, each key is listed as *Server Host Key* at the
bottom of the page. Clicking the small icon at the end of the key will copy it to your clipboard.

![](Images/first-time-setup-ssh-keys.png?raw=true)

Add each public key to `known_hosts`, one line per key with no trailing whitespace; this includes
trailing newline characters, which some text editors such as Atom may automatically insert.
